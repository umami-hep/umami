parameters:
  # Path where the ntuples are saved
  ntuple_path: &ntuple_path /work/ws/nemo/fr_af1100-Training-Simulations-0/ntuples_p3985/

  # Path where the hybrid samples will be saved
  sample_path: &sample_path /work/ws/nemo/fr_af1100-Training-Simulations-0/hybrids/

  # Path where the merged and ready-to-train samples are saved
  file_path: &file_path /work/ws/nemo/fr_af1100-Training-Simulations-0/preprocessed/

preparation:
  ntuples:
    ttbar:
      path: *ntuple_path
      file_pattern: user.mguth.410470.btagTraining.e6337_s3126_r10201_p3985.EMPFlow.2020-02-14-T232210-R26303_output.h5/*.h5

    zprime:
      path: *ntuple_path
      file_pattern: user.mguth.427081.btagTraining.e6928_e5984_s3126_r10201_r10210_p3985.EMPFlow.2020-02-15-T225316-R8334_output.h5/*.h5

  class_labels: [bjets, cjets, ujets]

  samples:
    training_ttbar_bjets:
      type: ttbar
      category: bjets
      n_jets: 10e6
      cuts:
        - eventNumber:
            operator: mod_6_<=
            condition: 3
        - pt_btagJes:
            operator: <=
            condition: 2.5e5
      f_output:
        path: *sample_path
        file: MC16d-bjets_training_ttbar_PFlow.h5

    training_ttbar_cjets:
      type: ttbar
      category: cjets
      # Number of c jets available in MC16d
      n_jets: 12745953
      cuts:
        - eventNumber:
            operator: mod_6_<=
            condition: 3
        - pt_btagJes:
            operator: <=
            condition: 2.5e5
      f_output:
        path: *sample_path
        file: MC16d-cjets_training_ttbar_PFlow.h5

    training_ttbar_ujets:
      type: ttbar
      category: ujets
      n_jets: 20e6
      cuts:
        - eventNumber:
            operator: mod_6_<=
            condition: 3
        - pt_btagJes:
            operator: <=
            condition: 2.5e5
      f_output:
        path: *sample_path
        file: MC16d-ujets_training_ttbar_PFlow.h5

    training_ttbar_taujets:
      type: ttbar
      category: taujets
      n_jets: 12745953
      cuts:
        - eventNumber:
            operator: mod_6_<=
            condition: 3
        - pt_btagJes:
            operator: <=
            condition: 2.5e5
      f_output:
        path: *sample_path
        file: MC16d-taujets_training_ttbar_PFlow.h5

    training_zprime_bjets:
      type: zprime
      category: bjets
      n_jets: 10e6
      cuts:
        - eventNumber:
            operator: mod_6_<=
            condition: 3
        - pt_btagJes:
            operator: ">"
            condition: 2.5e5
      f_output:
        path: *sample_path
        file: MC16d-bjets_training_zprime_PFlow.h5

    training_zprime_cjets:
      type: zprime
      category: cjets
      # Number of c jets available in MC16d
      n_jets: 10e6
      cuts:
        - eventNumber:
            operator: mod_6_<=
            condition: 3
        - pt_btagJes:
            operator: ">"
            condition: 2.5e5
      f_output:
        path: *sample_path
        file: MC16d-cjets_training_zprime_PFlow.h5

    training_zprime_ujets:
      type: zprime
      category: ujets
      n_jets: 10e6
      cuts:
        - eventNumber:
            operator: mod_6_<=
            condition: 3
        - pt_btagJes:
            operator: ">"
            condition: 2.5e5
      f_output:
        path: *sample_path
        file: MC16d-ujets_training_zprime_PFlow.h5

    training_zprime_taujets:
      type: zprime
      category: taujets
      n_jets: 10e6
      cuts:
        - eventNumber:
            operator: mod_6_<=
            condition: 3
        - pt_btagJes:
            operator: ">"
            condition: 2.5e5
      f_output:
        path: *sample_path
        file: MC16d-taujets_training_zprime_PFlow.h5

    validation_ttbar:
      type: ttbar
      category: inclusive
      n_jets: 4e6
      cuts:
        - eventNumber:
            operator: mod_6_==
            condition: 4
      f_output:
        path: *sample_path
        file: MC16d-inclusive_validation_ttbar_PFlow.h5

    testing_ttbar:
      type: ttbar
      category: inclusive
      n_jets: 4e6
      cuts:
        - eventNumber:
            operator: mod_6_==
            condition: 5
      f_output:
        path: *sample_path
        file: MC16d-inclusive_testing_ttbar_PFlow.h5

    validation_zprime:
      type: zprime
      category: inclusive
      n_jets: 4e6
      cuts:
        - eventNumber:
            operator: mod_6_==
            condition: 4
      f_output:
        path: *sample_path
        file: MC16d-inclusive_validation_zprime_PFlow.h5

    testing_zprime:
      type: zprime
      category: inclusive
      n_jets: 4e6
      cuts:
        - eventNumber:
            operator: mod_6_==
            condition: 5
      f_output:
        path: *sample_path
        file: MC16d-inclusive_testing_zprime_PFlow.h5

# amount of b-jets from ttbar which are used in the pre-resampling,
# can change after applying resampling in the hybrid sample creation
njets: 5.5e6

# fraction of ttbar jets wrt. Z'
# can change after applying resampling in the hybrid sample creation
ttbar_frac: 0.65

# Whether or not to enforce the ttbar fraction above
enforce_ttbar_frac: False

# outputfiles are split into 5
# iterations: 1
iterations: 5

# pT cut for hybrid creation (for light and c-jets)
pTcut: 2.5e5

# pT cut for b-jets
bhad_pTcut: 2.5e5

# upper pT limit for all jets
pT_max: False

# set to true if taus are to be included in preprocessing
bool_process_taus: False

# set to true if extended flavour labelling scheme is used in preprocessing
bool_extended_labelling: False

# Define undersampling method used. Valid are "count", "weight",
# "count_bcl_weight_tau", "template_b" and "template_b_count"
# count_bcl_weight_tau is a hybrid of count and weight to deal with taus.
# template_b uses the b as the target distribution, but does not guarantee
# same fractions. template_b_count will guarantee same fractions.
# The "template_b" and "template_b_count" does not work well with taus as of now.
# Additionally, when computing the target distribution for "template_b" and "template_b_count",
# pT_max (set above) will be used to compute the probability ratios or PDFs.
# Default is "count".
# See RunUndersampling in preprocessing for more info
sampling_method: count

# Name of the output file from the preprocessing
outfile_name: /work/ws/nemo/fr_af1100-Training-Simulations-0/preprocessed/PFlow-hybrid.h5
plot_name: PFlow_ext-hybrid

# Dictfile for the scaling and shifting (json)
dict_file: "/work/ws/nemo/fr_af1100-Training-Simulations-0/b-Tagging/scale_dicts/PFlow-scale_dict-22M.json"

# cut definitions to be applied to remove outliers
# possible operators: <, ==, >, >=, <=
cuts:
  JetFitterSecondaryVertex_mass:
    operator: <
    condition: 25000
    NaNcheck: True
  JetFitterSecondaryVertex_energy:
    operator: <
    condition: 1e8
    NaNcheck: True
  JetFitter_deltaR:
    operator: <
    condition: 0.6
    NaNcheck: True
  softMuon_pt:
    operator: <
    condition: 0.5e9
    NaNcheck: True
  softMuon_momentumBalanceSignificance:
    operator: <
    condition: 50
    NaNcheck: True
  softMuon_scatteringNeighbourSignificance:
    operator: <
    condition: 600
    NaNcheck: True
